<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Fundamental Analyzer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .input-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .results {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .data-point {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .fair-value {
            font-weight: bold;
            font-size: 18px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            border-radius: 5px;
        }
        .undervalued {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .overvalued {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .error {
            color: red;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid red;
            border-radius: 4px;
        }
        .manual-input {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9f4ff;
            border-radius: 5px;
        }
        .manual-input h3 {
            margin-top: 0;
        }
        .instructions {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .disclaimer {
            font-size: 0.8em;
            color: #666;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Stock Fundamental Analyzer</h1>
        
        <div class="instructions">
            <strong>Instructions:</strong> 
            <p>1. Enter stock symbol (e.g. PGEO)</p>
            <p>2. Click "Analyze" to fetch data from stockbit.com</p>
            <p>3. If scraping fails, use manual input fields below</p>
            <p><strong>NOTE:</strong> This tool requires running in browser extension or with CORS disabled to work with stockbit.com due to cross-origin policy</p>
        </div>
        
        <div class="input-section">
            <div class="input-group">
                <label for="symbol">Stock Symbol:</label>
                <input type="text" id="symbol" placeholder="Enter symbol (e.g. PGEO)">
            </div>
            <button id="analyze-btn">Analyze Stock</button>
        </div>
        
        <div id="manual-input" class="manual-input">
            <h3>Manual Data Input (Fallback)</h3>
            <div class="input-group">
                <label for="eps">EPS (Earnings Per Share):</label>
                <input type="number" id="eps" step="any" placeholder="Enter EPS">
            </div>
            <div class="input-group">
                <label for="per">PER (Price-to-Earnings Ratio):</label>
                <input type="number" id="per" step="any" placeholder="Enter PER">
            </div>
            <div class="input-group">
                <label for="pbv">PBV (Price-to-Book Value):</label>
                <input type="number" id="pbv" step="any" placeholder="Enter PBV">
            </div>
            <div class="input-group">
                <label for="book-value">Book Value per Share:</label>
                <input type="number" id="book-value" step="any" placeholder="Enter Book Value">
            </div>
            <div class="input-group">
                <label for="market-price">Market Price:</label>
                <input type="number" id="market-price" step="any" placeholder="Enter Market Price">
            </div>
            <button id="manual-analyze-btn">Analyze with Manual Data</button>
        </div>
        
        <div id="results" class="results" style="display: none;">
            <h2>Stock Analysis Results</h2>
            <div id="stock-data"></div>
            <div id="fair-value-results"></div>
            <div id="valuation-status"></div>
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
    </div>

    <script>
        // DOM elements
        const symbolInput = document.getElementById('symbol');
        const analyzeBtn = document.getElementById('analyze-btn');
        const manualAnalyzeBtn = document.getElementById('manual-analyze-btn');
        const resultsDiv = document.getElementById('results');
        const stockDataDiv = document.getElementById('stock-data');
        const fairValueResultsDiv = document.getElementById('fair-value-results');
        const valuationStatusDiv = document.getElementById('valuation-status');
        const errorDiv = document.getElementById('error');
        
        // Show error message
        function showError(message) {
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            resultsDiv.style.display = 'none';
        }
        
        // Hide error message
        function hideError() {
            errorDiv.style.display = 'none';
        }
        
        // Hide results
        function hideResults() {
            resultsDiv.style.display = 'none';
        }
        
        // Format numbers with 2 decimal places
        function formatNumber(num) {
            if (num === null || num === undefined) return 'N/A';
            return parseFloat(num).toLocaleString(undefined, {maximumFractionDigits: 2});
        }
        
        // Display stock data
        function displayStockData(data) {
            stockDataDiv.innerHTML = `
                <div class="data-point"><strong>Symbol:</strong> ${data.symbol}</div>
                <div class="data-point"><strong>EPS:</strong> ${formatNumber(data.eps)}</div>
                <div class="data-point"><strong>PER:</strong> ${formatNumber(data.per)}</div>
                <div class="data-point"><strong>PBV:</strong> ${formatNumber(data.pbv)}</div>
                <div class="data-point"><strong>Book Value per Share:</strong> ${formatNumber(data.bookValue)}</div>
                <div class="data-point"><strong>Market Price:</strong> ${formatNumber(data.marketPrice)}</div>
            `;
        }
        
        // Calculate and display fair value
        function calculateAndDisplayFairValue(data) {
            // Use industry averages for PER and PBV if not provided
            // In a real implementation, these would come from industry data
            const industryPER = data.per; // Using the stock's PER as a placeholder
            const industryPBV = data.pbv; // Using the stock's PBV as a placeholder
            
            // Calculate fair value using PER method
            const fairValuePER = data.eps * industryPER;
            
            // Calculate fair value using PBV method
            const fairValuePBV = data.pbv * data.bookValue;
            
            // Display fair values
            fairValueResultsDiv.innerHTML = `
                <div class="data-point">
                    <strong>Fair Value (PER Method):</strong> Rp ${formatNumber(fairValuePER)}
                </div>
                <div class="data-point">
                    <strong>Fair Value (PBV Method):</strong> Rp ${formatNumber(fairValuePBV)}
                </div>
                <div class="data-point">
                    <strong>Average Fair Value:</strong> Rp ${formatNumber((fairValuePER + fairValuePBV) / 2)}
                </div>
            `;
            
            // Determine if stock is overvalued or undervalued
            const averageFairValue = (fairValuePER + fairValuePBV) / 2;
            const marketPrice = data.marketPrice;
            
            let statusHTML = '';
            if (averageFairValue > marketPrice) {
                const discount = ((averageFairValue - marketPrice) / averageFairValue) * 100;
                statusHTML = `
                    <div class="fair-value undervalued">
                        <strong>Undervalued: ${formatNumber(discount)}% Discount</strong><br>
                        Fair Value (Rp ${formatNumber(averageFairValue)}) > Market Price (Rp ${formatNumber(marketPrice)})
                    </div>
                `;
            } else {
                const premium = ((marketPrice - averageFairValue) / averageFairValue) * 100;
                statusHTML = `
                    <div class="fair-value overvalued">
                        <strong>Overvalued: ${formatNumber(premium)}% Premium</strong><br>
                        Market Price (Rp ${formatNumber(marketPrice)}) > Fair Value (Rp ${formatNumber(averageFairValue)})
                    </div>
                `;
            }
            
            valuationStatusDiv.innerHTML = statusHTML;
            resultsDiv.style.display = 'block';
        }
        
        // Scrape data from stockbit.com
        async function scrapeStockData(symbol) {
            // The actual scraping would happen here
            // However, most websites (including stockbit.com) block requests from browsers due to CORS policy
            // For this example, we'll simulate the data
            return new Promise((resolve, reject) => {
                // Simulate an API call delay
                setTimeout(() => {
                    // This is a simulation because actual scraping requires disabling CORS or using a proxy
                    if (symbol.toUpperCase() === 'PGEO') {
                        // Example data for PGEO
                        resolve({
                            symbol: 'PGEO',
                            eps: 125.75,
                            per: 15.2,
                            pbv: 1.8,
                            bookValue: 1450.50,
                            marketPrice: 1850.00
                        });
                    } else if (symbol.toUpperCase() === 'BBCA') {
                        // Example data for BBCA
                        resolve({
                            symbol: 'BBCA',
                            eps: 3250.25,
                            per: 18.7,
                            pbv: 2.1,
                            bookValue: 19250.75,
                            marketPrice: 42000.00
                        });
                    } else {
                        // Default values for any other symbol
                        resolve({
                            symbol: symbol.toUpperCase(),
                            eps: 1000,
                            per: 15,
                            pbv: 1.5,
                            bookValue: 1500,
                            marketPrice: 2000
                        });
                    }
                }, 1000);
            });
        }
        
        // Event listener for analyze button
        analyzeBtn.addEventListener('click', async () => {
            const symbol = symbolInput.value.trim().toUpperCase();
            
            if (!symbol) {
                showError('Please enter a stock symbol');
                return;
            }
            
            hideError();
            
            try {
                // Show loading state
                analyzeBtn.disabled = true;
                analyzeBtn.textContent = 'Loading...';
                
                // In a real implementation, we would fetch data from stockbit.com
                // However, due to CORS policy, this only works in browser extensions or with disabled CORS
                const data = await scrapeStockData(symbol);
                
                displayStockData(data);
                calculateAndDisplayFairValue(data);
            } catch (error) {
                showError('Error fetching data. Please try manual input or check your connection. ' + error.message);
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'Analyze Stock';
            }
        });
        
        // Event listener for manual analyze button
        manualAnalyzeBtn.addEventListener('click', () => {
            const eps = parseFloat(document.getElementById('eps').value);
            const per = parseFloat(document.getElementById('per').value);
            const pbv = parseFloat(document.getElementById('pbv').value);
            const bookValue = parseFloat(document.getElementById('book-value').value);
            const marketPrice = parseFloat(document.getElementById('market-price').value);
            
            // Validate inputs
            if (isNaN(eps) || isNaN(per) || isNaN(pbv) || isNaN(bookValue) || isNaN(marketPrice)) {
                showError('Please fill in all values for manual analysis');
                return;
            }
            
            hideError();
            
            const data = {
                symbol: 'MANUAL',
                eps: eps,
                per: per,
                pbv: pbv,
                bookValue: bookValue,
                marketPrice: marketPrice
            };
            
            displayStockData(data);
            calculateAndDisplayFairValue(data);
        });
        
        // Example data for demonstration
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('eps').value = '125.75';
            document.getElementById('per').value = '15.2';
            document.getElementById('pbv').value = '1.8';
            document.getElementById('book-value').value = '1450.50';
            document.getElementById('market-price').value = '1850.00';
        });
    </script>
    
    <div class="disclaimer">
        <strong>Disclaimer:</strong> This tool is for educational purposes only. Stock data is simulated for demonstration. 
        Real financial decisions should be based on thorough research and professional advice. 
        Note that web scraping may violate terms of service of websites and should be used responsibly and legally.
    </div>
</body>
</html>